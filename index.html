<!doctype html>
<html lang="en" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Speed Typer Pro</title>
    <script src="https://cdn.tailwindcss.com/3.4.17"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.1/firebase-database-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        @keyframes gradient-shift { 0%, 100% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } }
        @keyframes float { 0%, 100% { transform: translateY(0px); } 50% { transform: translateY(-10px); } }
        @keyframes pulse-glow { 0%, 100% { box-shadow: 0 0 20px rgba(99, 102, 241, 0.3); } 50% { box-shadow: 0 0 40px rgba(99, 102, 241, 0.6); } }
        @keyframes confetti { 0% { transform: translateY(0) rotate(0deg); opacity: 1; } 100% { transform: translateY(-100px) rotate(720deg); opacity: 0; } }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
        
        .animate-gradient { background-size: 200% 200%; animation: gradient-shift 8s ease infinite; }
        .animate-float { animation: float 3s ease-in-out infinite; }
        .animate-pulse-glow { animation: pulse-glow 2s ease-in-out infinite; }
        .animate-confetti { animation: confetti 1s ease-out forwards; }
        .animate-shake { animation: shake 0.3s ease-in-out; }
        
        .char-correct { color: #10b981; }
        .char-incorrect { color: #ef4444; text-decoration: underline; background: rgba(239, 68, 68, 0.2); }
        .char-current { background: rgba(99, 102, 241, 0.5); border-radius: 2px; }
        .glass-card { background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.1); }
    </style>
</head>
<body class="h-full m-0 overflow-auto bg-slate-900 text-white selection:bg-purple-500/30">
    <div id="app-container" class="min-h-full bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 animate-gradient p-4 md:p-8">
        <div id="particles" class="fixed inset-0 pointer-events-none z-0"></div>

        <div class="relative z-10 max-w-4xl mx-auto">
            <header class="text-center mb-8">
                <h1 class="text-4xl md:text-6xl font-black mb-2 bg-gradient-to-r from-cyan-400 via-purple-500 to-pink-500 bg-clip-text text-transparent" style="font-family: 'Orbitron', sans-serif;">‚ö° Speed Typer Pro ‚ö°</h1>
                <p class="text-lg text-purple-300" style="font-family: 'Space Mono', monospace;">Master the keys, dominate the board.</p>
            </header>

            <div id="name-setup" class="glass-card rounded-3xl p-8 max-w-md mx-auto">
                <div class="text-center mb-6">
                    <div class="text-6xl mb-4 animate-float">üéÆ</div>
                    <h2 class="text-2xl font-bold mb-2" style="font-family: 'Orbitron', sans-serif;">Welcome, Challenger!</h2>
                    <p class="text-purple-300">Enter your name to begin</p>
                </div>
                <div class="space-y-4">
                    <input type="text" id="username-input" class="w-full px-6 py-4 bg-slate-800/50 border-2 border-purple-500/50 rounded-xl text-white focus:outline-none focus:border-cyan-400 transition-all" placeholder="Username..." maxlength="15">
                    <button onclick="saveName()" class="w-full py-4 bg-gradient-to-r from-cyan-500 to-purple-600 rounded-xl text-xl font-bold hover:scale-105 transition-all animate-pulse-glow">üöÄ Start Playing</button>
                </div>
            </div>

            <div id="game-area" class="hidden">
                <div class="glass-card rounded-2xl p-4 mb-6 flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <div id="player-avatar" class="w-12 h-12 rounded-full bg-gradient-to-br from-cyan-400 to-purple-600 flex items-center justify-center text-2xl font-bold">?</div>
                        <div>
                            <p class="text-sm text-purple-300">Player</p>
                            <p id="player-name" class="font-bold text-lg">Guest</p>
                        </div>
                    </div>
                    <button onclick="changeQuote()" class="px-4 py-2 bg-purple-600/50 hover:bg-purple-500/50 rounded-lg transition-all">üîÑ New Quote</button>
                </div>
                <div class="flex justify-center gap-4 mb-6">
    <button onclick="setDuration(15)" class="duration-btn px-4 py-1 rounded-full border border-purple-500/30 hover:bg-purple-500/20 transition-all text-sm">15s</button>
    <button onclick="setDuration(30)" class="duration-btn px-4 py-1 rounded-full border border-purple-500/30 hover:bg-purple-500/20 bg-purple-500/40 transition-all text-sm">30s</button>
    <button onclick="setDuration(60)" class="duration-btn px-4 py-1 rounded-full border border-purple-500/30 hover:bg-purple-500/20 transition-all text-sm">60s</button>
</div>

                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                    <div class="glass-card rounded-2xl p-4 text-center">
                        <p class="text-3xl font-black text-cyan-400" id="wpm-display">0</p>
                        <p class="text-xs text-purple-300 uppercase tracking-widest">WPM</p>
                    </div>
                    <div class="glass-card rounded-2xl p-4 text-center">
                        <p class="text-3xl font-black text-green-400" id="accuracy-display">100%</p>
                        <p class="text-xs text-purple-300 uppercase tracking-widest">Accuracy</p>
                    </div>
                    <div class="glass-card rounded-2xl p-4 text-center">
                        <p class="text-3xl font-black text-yellow-400" id="time-display">0.0</p>
                        <p class="text-xs text-purple-300 uppercase tracking-widest">Seconds</p>
                    </div>
                    <div class="glass-card rounded-2xl p-4 text-center">
                        <p class="text-3xl font-black text-pink-400" id="chars-display">0</p>
                        <p class="text-xs text-purple-300 uppercase tracking-widest">Characters</p>
                    </div>
                </div>

                <div class="glass-card rounded-3xl p-6 md:p-8 mb-6">
                    <div id="quote-display" class="text-xl md:text-2xl leading-relaxed tracking-wide mb-6 p-6 bg-slate-900/50 rounded-xl min-h-[100px]" style="font-family: 'Space Mono', monospace;"></div>
                    <textarea id="quote-input" 
                              class="w-full h-32 px-6 py-4 bg-slate-800/50 border-2 border-purple-500/50 rounded-xl text-white text-lg focus:outline-none focus:border-cyan-400 transition-all resize-none" 
                              placeholder="Start typing to begin..."
                              onpaste="return false"></textarea>
                </div>

                <div class="glass-card rounded-full h-4 p-1 mb-8 overflow-hidden">
                    <div id="progress-bar" class="h-full bg-gradient-to-r from-cyan-400 to-purple-500 rounded-full transition-all duration-300" style="width: 0%"></div>
                </div>
            </div>

            <div id="scoreboard" class="hidden glass-card rounded-3xl p-6">
                <h2 class="text-2xl font-black text-center mb-6" style="font-family: 'Orbitron', sans-serif;">üèÜ Global Leaderboard</h2>
                <div id="leaderboard-list" class="space-y-3"></div>
            </div>
        </div>

        <div id="results-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4">
            <div class="absolute inset-0 bg-black/80 backdrop-blur-md"></div>
            <div class="relative glass-card rounded-3xl p-8 max-w-md w-full text-center">
                <div id="confetti-container" class="absolute inset-0 pointer-events-none"></div>
                <div class="text-8xl mb-4" id="result-emoji">üèÜ</div>
                <h2 class="text-3xl font-black mb-2" id="result-title">Amazing!</h2>
                <div class="grid grid-cols-2 gap-4 my-6">
                    <div class="bg-slate-800/50 rounded-xl p-4">
                        <p class="text-3xl font-black text-cyan-400" id="final-wpm">0</p>
                        <p class="text-sm text-purple-300">WPM</p>
                    </div>
                    <div class="bg-slate-800/50 rounded-xl p-4">
                        <p class="text-3xl font-black text-green-400" id="final-accuracy">0%</p>
                        <p class="text-sm text-purple-300">Accuracy</p>
                    </div>
                </div>
                <button onclick="playAgain()" class="w-full py-4 bg-gradient-to-r from-cyan-500 to-purple-600 rounded-xl font-bold hover:scale-105 transition-all">Play Again</button>
            </div>
        </div>
    </div>

    <script>
        // --- FIREBASE CONFIGURATION ---
const firebaseConfig = {
    apiKey: "AIzaSyB3ZwWo8df2_8YKkeupwgWj5oA2OWlXOuY",
    authDomain: "typing-game-2ae52.firebaseapp.com",
    databaseURL: "https://typing-game-2ae52-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "typing-game-2ae52",
    storageBucket: "typing-game-2ae52.firebasestorage.app",
    messagingSenderId: "343867373599",
    appId: "1:343867373599:web:8b3a96de4b369c1963fd2a"
};

// Initialize Firebase
if (!firebase.apps.length) {
    firebase.initializeApp(firebaseConfig);
}
const db = firebase.database();

// --- GAME STATE ---
const quotes = [
    { text: "The quick brown fox jumps over the lazy dog.", category: "Classic" },
    { text: "First, solve the problem. Then, write the code.", category: "Dev" },
    { text: "Code is like humor. When you have to explain it, it's bad.", category: "Dev" },
    { text: "In the middle of difficulty lies opportunity.", category: "Wisdom" },
    { text: "Stay hungry, stay foolish, and keep pushing forward.", category: "Wisdom" }
];

let playerName = localStorage.getItem('speedTyperName') || '';
let currentQuote = quotes[0];
let startTime = null;
let timerInterval = null;
let isGameActive = false;
let isGameComplete = false;

// --- CORE FUNCTIONS ---

function showNameSetup() {
    document.getElementById('name-setup').classList.remove('hidden');
    document.getElementById('game-area').classList.add('hidden');
    document.getElementById('scoreboard').classList.add('hidden');
}

function saveName() {
    const input = document.getElementById('username-input');
    const name = input.value.trim();
    
    if (!name) {
        input.classList.add('animate-shake');
        setTimeout(() => input.classList.remove('animate-shake'), 300);
        return;
    }
    
    playerName = name;
    localStorage.setItem('speedTyperName', playerName);
    showGameArea();
}

function showGameArea() {
    document.getElementById('name-setup').classList.add('hidden');
    document.getElementById('game-area').classList.remove('hidden');
    document.getElementById('scoreboard').classList.remove('hidden');
    document.getElementById('player-name').textContent = playerName;
    document.getElementById('player-avatar').textContent = playerName.charAt(0).toUpperCase();
    changeQuote();
}

function changeQuote() {
    currentQuote = quotes[Math.floor(Math.random() * quotes.length)];
    resetGame();
}

function resetGame() {
    clearInterval(timerInterval);
    startTime = null;
    isGameActive = false;
    isGameComplete = false;
    document.getElementById('quote-input').value = '';
    document.getElementById('wpm-display').textContent = '0';
    document.getElementById('time-display').textContent = '0.0';
    document.getElementById('accuracy-display').textContent = '100%';
    document.getElementById('progress-bar').style.width = '0%';
    renderQuote();
}

let gameDuration = 30; // Default

function renderQuote() {
    const display = document.getElementById('quote-display');
    // regex: lowercase everything and remove anything that isn't a-z or a space
    const cleanText = currentQuote.text.toLowerCase().replace(/[^a-z ]/g, "");
    
    // Update the currentQuote.text so the comparison logic stays correct
    currentQuote.processedText = cleanText;

    display.innerHTML = cleanText.split('').map((char, i) => 
        `<span class="char" id="char-${i}">${char}</span>`
    ).join('');
}
        
function setDuration(seconds) {
    gameDuration = seconds;
    // Update UI buttons visual state
    document.querySelectorAll('.duration-btn').forEach(btn => {
        btn.classList.toggle('bg-purple-500/40', btn.innerText.includes(seconds));
    });
    resetGame();
}

document.getElementById('quote-input').addEventListener('input', (e) => {
    if (isGameComplete) return;
    
    const val = e.target.value;
    
    if (!isGameActive && val.length > 0) {
        isGameActive = true;
        startTime = Date.now();
        let timeLeft = gameDuration;

        timerInterval = setInterval(() => {
            const elapsed = (Date.now() - startTime) / 1000;
            timeLeft = gameDuration - elapsed;
            
            if (timeLeft <= 0) {
                document.getElementById('time-display').textContent = "0.0";
                const wpm = Math.round((val.length / 5) / (gameDuration / 60));
                finishGame(wpm);
            } else {
                document.getElementById('time-display').textContent = timeLeft.toFixed(1);
            }
        }, 100);
    }

    updateTypingVisuals(val);
    
    // Monkeytype behavior: If they finish the quote before time is up, 
    // you could either end the game or just generate a new quote.
    // For now, let's just let the timer be the boss.
});

    updateTypingVisuals(val);

    if (val === currentQuote.text) {
        const elapsed = (Date.now() - startTime) / 1000;
        const wpm = Math.round((val.length / 5) / (elapsed / 60));
        finishGame(wpm);
    }
});

function updateTypingVisuals(input) {
    const quoteText = currentQuote.text;
    let correctCount = 0;

    for (let i = 0; i < quoteText.length; i++) {
        const charSpan = document.getElementById(`char-${i}`);
        if (!charSpan) continue;

        if (i < input.length) {
            if (input[i] === quoteText[i]) {
                charSpan.className = 'char char-correct';
                correctCount++;
            } else {
                charSpan.className = 'char char-incorrect';
            }
        } else if (i === input.length) {
            charSpan.className = 'char char-current';
        } else {
            charSpan.className = 'char';
        }
    }

    const accuracy = Math.round((correctCount / Math.max(input.length, 1)) * 100);
    document.getElementById('accuracy-display').textContent = accuracy + '%';
    document.getElementById('progress-bar').style.width = (input.length / quoteText.length * 100) + '%';
}

function finishGame(wpm) {
    isGameComplete = true;
    isGameActive = false;
    clearInterval(timerInterval);
    
    const accuracy = document.getElementById('accuracy-display').textContent;
    document.getElementById('final-wpm').textContent = wpm;
    document.getElementById('final-accuracy').textContent = accuracy;
    document.getElementById('results-modal').classList.remove('hidden');

    // Reference to this specific player's record
    // We sanitize the name by removing dots, etc., as Firebase keys can't have them
    const safePlayerKey = playerName.replace(/[.#$\[\]]/g, "_");
    const playerRef = db.ref('leaderboard/' + safePlayerKey);

    playerRef.once('value').then((snapshot) => {
        const data = snapshot.val();
        
        // Only update if the record doesn't exist OR if the new WPM is higher
        if (!data || wpm > data.wpm) {
            playerRef.set({
                player_name: playerName,
                wpm: wpm,
                accuracy: accuracy,
                timestamp: Date.now()
            });
        }
    });
}


function playAgain() {
    document.getElementById('results-modal').classList.add('hidden');
    changeQuote();
}

function listenToLeaderboard() {
    db.ref('leaderboard').orderByChild('wpm').limitToLast(10).on('value', (snapshot) => {
        const list = [];
        snapshot.forEach(child => {
            list.push(child.val());
        });
        list.sort((a, b) => b.wpm - a.wpm);
        
        const container = document.getElementById('leaderboard-list');
        if(!container) return;

        container.innerHTML = list.map((entry, i) => `
            <div class="flex items-center justify-between p-4 bg-slate-800/40 rounded-xl border border-white/5">
                <div class="flex items-center gap-4">
                    <span class="text-xl font-bold w-8">${i + 1}.</span>
                    <div>
                        <p class="font-bold text-cyan-400">${entry.player_name}</p>
                        <p class="text-xs text-purple-300">${entry.accuracy} accuracy</p>
                    </div>
                </div>
                <div class="text-right">
                    <span class="text-2xl font-black">${entry.wpm}</span>
                    <span class="text-xs block text-purple-300">WPM</span>
                </div>
            </div>
        `).join('');
    });
}

function createParticles() {
    const container = document.getElementById('particles');
    if(!container) return;
    for (let i = 0; i < 30; i++) {
        const p = document.createElement('div');
        p.className = 'absolute rounded-full opacity-20 bg-purple-500';
        const size = Math.random() * 4 + 2 + 'px';
        p.style.width = size; p.style.height = size;
        p.style.left = Math.random() * 100 + '%';
        p.style.top = Math.random() * 100 + '%';
        p.style.animation = `float ${3 + Math.random() * 3}s infinite`;
        container.appendChild(p);
    }
}

// --- START EVERYTHING ---
function init() {
    createParticles();
    if (playerName) {
        showGameArea();
    } else {
        showNameSetup();
    }
    listenToLeaderboard();
    console.log("Game Initialized!");
}

init();
    </script>
</body>
</html>
